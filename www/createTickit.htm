<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Flippadoo Form Tester</title>
<link href="createTickit_files/style.css" rel="stylesheet" type="text/css">
<link href="createTickit_files/jquery.css" rel="stylesheet" type="text/css">
<script src="createTickit_files/jquery.js"></script>
<script src="createTickit_files/jquery_002.js"></script>
<script src="createTickit_files/tickit.js"></script>
<script>
    
function creatTickitFn() {
    var apiKey = $('#apiKey').val();
	var url = 'http://dev.tickittaskit.com/flippadoo/mobile/tickitService/'+apiKey+'/createTickit';
 	$("#createTickit").attr("action",url);
	$("#createTickit").submit();
}
function loadPage(url) {
    var xmlhttp = new XMLHttpRequest();
    alert("Page request for " + url);
    // Callback function when XMLHttpRequest is ready
    xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState === 4) {
            if (xmlhttp.status === 200) {
                document.getElementById('container').innerHTML = xmlhttp.responseText;
            }
        }
    };
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
}
function GetLocationForm() {
    alert("Redirect to the form");
    loadPage('GetLocation.html');
}

function getSimpleLocation() {

    var locOptions = {
        timeout: 5000,
        enableHighAccuracy: true
    };
    //get the current location
    navigator.geolocation.getCurrentPosition(onLocationSimple, onLocationError, locOptions);
    //Clear the current location while we wait for a reading


}

function getLocation() {
           
        var locOptions = {
            timeout: 5000,
            enableHighAccuracy: true
        };
        //get the current location
        navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError, locOptions);
        //Clear the current location while we wait for a reading
        

}

function onLocationSuccess(loc) {
    
    //alert("onLocationSuccess");    
    //We received something from the API, so first get the
    // timestamp in a date object so we can work with it
    var d = new Date(loc.timestamp);
    //Then replace the page's content with the current
    // location retrieved from the API
    var gpsLocation = loc.coords.latitude + ';' + loc.coords.longitude;
    var HTMLStr = '<b>Current Location</b><hr /><b>Latitude</b>: ' + loc.coords.latitude + '<br /><b>Longitude</b>: ' + loc.coords.longitude + '<br /><b>Altitude</b>: ' + loc.coords.altitude + '<br /><b>Accuracy</b>: ' + loc.coords.accuracy + '<br /><b>Altitude Accuracy</b>: ' + loc.coords.altitudeAccuracy + '<br /><b>Heading</b>: ' + loc.coords.heading + '<br /><b>Speed</b>: ' + loc.coords.speed + '<br /><b>Timestamp</b>: ' + d.toLocaleString();
    alert("HTML String is: " + HTMLStr);
    window.localStorage.setItem("GPSData", HTMLStr);
    window.localStorage.setItem("GPSKey", gpsLocation);
    alert("GPS short String is: " + gpsLocation);
    document.write('Here it is <br><input value="' + gpsLocation + '" name="gps" type="text">');                                  
   
}

function onLocationError(e) {
    alert("Geolocation error: #" + e.code + "\n" + e.message);
}

</script>
    
</head>

<body onload="getLocation();">
    <div id='container'>
    <div class="wrapper">    
        <div class="formContainer">
        <form name="createTickit" id="createTickit" action="/flippadoo/mobile/tickitService/createTickit" enctype="multipart/form-data" method="post">              
                    <input name="ownerId" value="1" type="hidden">
  		            <input name="apiKey" id="apiKey" value="355901361" type="hidden">
                    <input name="ip" value="http://192.168.1.240:8080" type="hidden">               
                    <input name="tickitStatus" value="1" type="hidden">
                    <input name="tickitType" value="11" type="hidden">               
                    <input value="ChrisHealy@test.com" name="recipient" type="text">
                    <input value="Whami Location" name="subject" type="text">
                    <input value="" id="idStartDate" name="startDate" type="text">
                    <input value="" name="endDate" type="hidden">
                    <script type="text/javascript">
                        var GPSData = window.localStorage.getItem("GpsData");
                        document.write('<input value="' + GPSData + '" name="msgBody" type="text">');
                    </script>
                    <script type="text/javascript">
                        var GPSvalue = window.localStorage.getItem("GpsKey");
                        //document.write('<input value="' + GPSvalue + '" name="gps" type="text">');
                    </script>                    
                    <input value="" name="tickitFile" type="hidden">
          
             <div class="buttonBlock">
                <button onclick="creatTickitFn();">Whami</button>
                <input type="button" value="Location" onclick="getLocation();">
            </div>                  
    </form>
         
     </div>  
    </div>  
  </div>
</body>
</html>