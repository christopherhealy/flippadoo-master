<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Flippadoo Form Tester</title>
<link href="createTickit_files/style.css" rel="stylesheet" type="text/css">
<link href="createTickit_files/jquery.css" rel="stylesheet" type="text/css">
<script src="createTickit_files/jquery.js"></script>
<script src="createTickit_files/jquery_002.js"></script>
<script src="createTickit_files/tickit.js"></script>
<script>
    
function creatTickitFn() {
    var apiKey = $('#apiKey').val();
	var url = 'http://dev.tickittaskit.com/flippadoo/mobile/tickitService/'+apiKey+'/createTickit';
 	$("#createTickit").attr("action",url);
	$("#createTickit").submit();
}
function loadPage(url) {
    var xmlhttp = new XMLHttpRequest();
    alert("Page request for " + url);
    // Callback function when XMLHttpRequest is ready
    xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState === 4) {
            if (xmlhttp.status === 200) {
                document.getElementById('container').innerHTML = xmlhttp.responseText;
            }
        }
    };
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
}

function getLocation() {
           
        var locOptions = {
            timeout: 5000,
            enableHighAccuracy: true
        };
        //get the current location
        navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError, locOptions);
        //Clear the current location while we wait for a reading
        

}

function CreateFormTop() {
    var TickitForm ='<div id="container">';
    TickitForm = TickitForm + '<div class="wrapper">  '; 
    TickitForm = TickitForm + '<div class="formContainer">';
    TickitForm = TickitForm + '<form name="createTickit" id="createTickit" action="/flippadoo/mobile/tickitService/createTickit" enctype="multipart/form-data" method="post">  ';            
    TickitForm = TickitForm + '<input name="ownerId" value="1" type="hidden">';
    TickitForm = TickitForm + '<input name="apiKey" id="apiKey" value="355901361" type="hidden">';
    TickitForm = TickitForm + '<input name="ip" value="http://192.168.1.240:8080" type="hidden">     ';          
    TickitForm = TickitForm + '<input name="tickitStatus" value="1" type="hidden">';
    TickitForm = TickitForm + '<input name="tickitType" value="11" type="hidden">   ';            
    TickitForm = TickitForm + '<input value="ChrisHealy@test.com" name="recipient" type="text">';
    TickitForm = TickitForm + '<input value="Whami Location" name="subject" type="text">';
    TickitForm = TickitForm + '<input value="" id="idStartDate" name="startDate" type="text">';
    TickitForm = TickitForm + '<input value="" name="endDate" type="hidden">';    
    document.write(TickitForm);
}

function CreateFormBottom() {
    var TickitForm = '';
    TickitForm = TickitForm + '<input value="" name="tickitFile" type="hidden"> ';
    TickitForm = TickitForm + '<div class="buttonBlock"> ';
    TickitForm = TickitForm + '<button onclick="creatTickitFn();">Whami</button> ';
    TickitForm = TickitForm + '<input type="button" value="Location" onclick="getLocation();"> ';
    TickitForm = TickitForm + '</div> </form></div></div></div>';
    document.write(TickitForm);
}
function onLocationSuccess(loc) {
    
    //alert("onLocationSuccess");    
    //We received something from the API, so first get the
    // timestamp in a date object so we can work with it
    var d = new Date(loc.timestamp);
    //Then replace the page's content with the current
    // location retrieved from the API
    var gpsLocation = loc.coords.latitude + ';' + loc.coords.longitude;
    var gpsAltitude = loc.coords.altitude + ' (' + loc.coords.altitudeAccuracy + ')';
    var CurDateTime = d.toLocaleString();
    var HTMLStr = 'Altitude\n: ' + loc.coords.altitude + 'Accuracy\n: ' + loc.coords.accuracy + 'Altitude Accuracy\n: '
        + loc.coords.altitudeAccuracy + 'Heading\n: ' + loc.coords.heading + 'Speed\n: '
        + loc.coords.speed + 'Timestamp\n: ' + d.toLocaleString();
    
    document.write('<br><h1>Tickit Form 3 </h1><br><div id="container">');
    document.write('<form name="createTickit" id="createTickit" action="/flippadoo/mobile/tickitService/createTickit" enctype="multipart/form-data" method="post">  ');
    document.write('Owner ID:      <input name="ownerId" value="1" type="text"><br>');
    document.write('<input name="apiKey" id="apiKey" value="355901361" type="hidden">');
    document.write('<input name="ip" value="http://192.168.1.240:8080" type="hidden">    ');
    document.write('<input name="tickitStatus" value="1" type="hidden">');
    document.write('<input name="tickitType" value="11" type="hidden">   ');
    document.write('Recipient:     <input value="ChrisHealy@test.com" name="recipient" type="text"><br>');
    document.write('Subject:       <input value="Whami Location" name="subject" type="text"><br>');
    document.write('Start:         <input value="' + CurDateTime + ' name="startDate" type="text"><br>');
    document.write('<input value="" name="endDate" type="hidden">');
    document.write('GPS:           <input value="' + gpsLocation + '" name="gps" type="text"><br>');
    document.write('<input value="' + gpsAltitude + '" name="msgBody" type="text">');
    document.write('<input value="" name="tickitFile" type="hidden">');
    document.write('<div> <br><br>');
    document.write('<button onclick="creatTickitFn();">Share</button> ');
    //document.write('<input type="button" value="Location" onclick="getLocation();">');
    document.write('</div> </form></div>');
   
}

function onLocationError(e) {
    alert("Geolocation error: #" + e.code + "\n" + e.message);
}

</script>
    
</head>

<body onload="getLocation();">
   <!-- the form will load here -->
     
</body>
</html>